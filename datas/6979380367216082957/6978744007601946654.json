{"article_id": "6978744007601946654", "article_info": {"article_id": "6978744007601946654", "user_id": "131597122679661", "category_id": "6809637767543259144", "tag_ids": [6809640407484334093], "visible_level": 0, "link_url": "", "cover_image": "", "is_gfw": 0, "title": "\u4e09\u5343\u6587\u5b57\uff0c\u4e5f\u6ca1\u5199\u597d Function.prototype.call", "brief_content": "Function.prototype.call\uff0c\u624b\u5199\u7cfb\u5217\uff0c\u4e07\u6587\u9762\u8bd5\u7cfb\u5217\uff0c\u5fc5\u4f1a\u7cfb\u5217\u5fc5\u5305\u542b\u7684\u5185\u5bb9\uff0c\u8db3\u89c1\u5176\u5728\u524d\u7aef\u7684\u5206\u91cf\u3002 \u672c\u6587\u57fa\u4e8eMDN \u548c ECMA \u6807\u51c6\uff0c\u548c\u5927\u5bb6\u4e00\u8d77\u4ece\u65b0\u8ba4\u8bc6call\u3002", "is_english": 0, "is_original": 1, "user_index": 0, "original_type": 0, "original_author": "", "content": "", "ctime": "1624865501", "mtime": "1626773372", "rtime": "1624937766", "draft_id": "6978455767502290974", "view_count": 9753, "collect_count": 192, "digg_count": 238, "comment_count": 62, "hot_index": 787, "is_hot": 0, "rank_index": 0.12902143, "status": 2, "verify_status": 1, "audit_status": 2, "mark_content": "---\ntheme: channing-cyan\n---\n\n## \u524d\u8a00\n`Function.prototype.call`\uff0c\u624b\u5199\u7cfb\u5217\uff0c\u4e07\u6587\u9762\u8bd5\u7cfb\u5217\uff0c\u5fc5\u4f1a\u7cfb\u5217\u5fc5\u5305\u542b\u7684\u5185\u5bb9\uff0c\u8db3\u89c1\u5176\u5728\u524d\u7aef\u7684\u5206\u91cf\u3002   \n\u672c\u6587\u57fa\u4e8e**MDN** \u548c **ECMA** \u6807\u51c6\uff0c\u548c\u5927\u5bb6\u4e00\u8d77\u4ece\u65b0\u8ba4\u8bc6`call`\u3002    \n\n\u6d89\u53ca\u77e5\u8bc6\u70b9\uff1a\n1. [undefined](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/undefined)\n2. [void \u4e00\u5143\u8fd0\u7b97\u7b26](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/void)   \n3. [\u4e25\u683c\u6a21\u5f0f](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Strict_mode)\u548c\u975e\u4e25\u683c\u6a21\u5f0f\n4. \u6d4f\u89c8\u5668\u548cnodejs\u73af\u5883\u8bc6\u522b\n5. \u51fd\u6570\u526f\u4f5c\u7528 \uff08\u7eaf\u51fd\u6570\uff09\n6. [eval](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/eval)\n7. [Content-Security-Policy](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CSP)\n8. [delete](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/delete) \n9. [new Function](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function)   \n10. [Object.freeze](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/freeze)\n11. \u5bf9\u8c61\u5c5e\u6027\u68c0\u67e5\n12. \u9762\u8bd5\u73b0\u573a\n13. ECMA\u89c4\u8303\u548c\u6d4f\u89c8\u5668\u5382\u5546\u4e4b\u95f4\u7684\u7231\u6068\u60c5\u4ec7\n\n\n## \u6398\u91d1\u6d41\u884c\u7684\u7248\u672c\n\n\u9762\u8bd5\u5b98\u7684\u95ee\u9898\uff1a   \n**\u9ebb\u70e6\u4f60\u624b\u5199\u4e00\u4e0b`Function.prototype.call`**\n\n### \u57fa\u4e8e`ES6\u7684\u62d3\u5c55\u8fd0\u7b97\u7b26`\u7248\u672c\n```js\nFunction.prototype.call = function(context) {\n    context = context || window;\n    context[\"fn\"] = this;\n    let arg = [...arguments].slice(1); \n    context[\"fn\"](...arg);\n    delete context[\"fn\"];\n}\n```\n\u8fd9\u4e2a\u7248\u672c\uff0c\u5e94\u8be5\u4e0d\u662f\u9762\u8bd5\u5b98\u60f3\u8981\u7684\u771f\u6b63\u7b54\u6848\u3002\u4e0d\u505a\u592a\u591a\u89e3\u6790\u3002\n### \u57fa\u4e8e`eval`\u7684\u7248\u672c\n```js\nFunction.prototype.call = function (context) {\n  context = (context == null || context == undefined) ? window : new  Object(context);\n  context.fn = this;\n  var arr = [];\n  for (var i = 1; i < arguments.length; i++) {\n    arr.push('arguments[' + i + ']');\n  }\n  var r = eval('context.fn(' + arr + ')');\n  delete context.fn;\n  return r;\n}\n```\n\u8fd9\u4e2a\u7248\u672c\u503c\u5f97\u5b8c\u5584\u7684\u5730\u65b9\n1. `this` \u662f\u4e0d\u662f\u51fd\u6570\u6ca1\u6709\u8fdb\u884c\u5224\u65ad\n2. \u4f7f\u7528undefined\u8fdb\u884c\u5224\u65ad\uff0c\u5b89\u5168\u4e0d\u5b89\u5168   \n    undefined \u53ef\u80fd\u88ab\u6539\u5199\uff0c\uff08\u9ad8\u7248\u672c\u6d4f\u89c8\u5668\u5df2\u505a\u9650\u5236\uff09\u3002\n3. \u76f4\u63a5\u4f7f\u7528window\u4f5c\u4e3a\u9ed8\u8ba4\u4e0a\u4e0b\u6587\uff0c\u8fc7\u4e8e\u6b66\u65ad\u3002   \n    \u811a\u672c\u8fd0\u884c\u73af\u5883\uff0c\u6d4f\u89c8\u5668\uff1f nodejs\uff1f    \n    \u51fd\u6570\u8fd0\u884c\u6a21\u5f0f\uff0c\u4e25\u683c\u6a21\u5f0f\uff0c\u975e\u4e25\u683c\u6a21\u5f0f\uff1f\n4. `eval` \u4e00\u5b9a\u4f1a\u88ab\u5141\u8bb8\u6267\u884c\u5417\n5. delete context.fn \u6709\u6ca1\u6709\u4ea7\u751f\u526f\u4f5c\u7528   \n    context\u4e0a\u8981\u662f\u539f\u6765\u6709fn\u5c5e\u6027\u5462\n\n\n\u5728\u6211\u4eec\u771f\u6b63\u5f00\u59cb\u5199`Function.prototype.call`\u4e4b\u524d\uff0c\u8fd8\u662f\u5148\u6765\u770b\u770bMDN\u548c ECMA\u662f\u600e\u4e48\u5b9a\u4e49\u5979\u7684\u3002\n\n## MDN call \u7684\u8bf4\u660e\n### \u8bed\u6cd5\n```js\nfunction.call(thisArg, arg1, arg2, ...)\n```\n### \u53c2\u6570\n`thisArg`   \n\n\u53ef\u9009\u7684\u3002\u5728 function \u51fd\u6570\u8fd0\u884c\u65f6\u4f7f\u7528\u7684 this \u503c\u3002\u8bf7\u6ce8\u610f\uff0cthis\u53ef\u80fd\u4e0d\u662f\u8be5\u65b9\u6cd5\u770b\u5230\u7684\u5b9e\u9645\u503c\uff1a\u5982\u679c\u8fd9\u4e2a\u51fd\u6570\u5904\u4e8e**\u975e\u4e25\u683c\u6a21\u5f0f\u4e0b**\uff0c\u5219\u6307\u5b9a\u4e3a null \u6216 undefined \u65f6\u4f1a\u81ea\u52a8\u66ff\u6362\u4e3a\u6307\u5411**\u5168\u5c40\u5bf9\u8c61**\uff0c**\u539f\u59cb\u503c\u4f1a\u88ab\u5305\u88c5**\u3002   \n`arg1, arg2, ...`    \n\u6307\u5b9a\u7684\u53c2\u6570\u5217\u8868\u3002\n\n### \u900f\u9732\u7684\u4fe1\u606f\n\u8fd9\u91cc\u900f\u9732\u4e86\u51e0\u4e2a\u4fe1\u606f\uff0c\u6211\u5df2\u7ecf\u52a0\u7c97\u6807\u6ce8\uff1a\n1. \u975e\u4e25\u683c\u6a21\u5f0f\uff0c\u5bf9\u5e94\u7684\u6709\u4e25\u683c\u6a21\u5f0f\n2. \u8fd9\u91cc\u8bf4\u7684\u662f\u6307\u5411 \u5168\u5c40\u5bf9\u8c61\uff0c\u6ca1\u6709\u8bf4\u662f`window`\u3002\u5f53\u7136MDN\u8fd9\u91cc\u8bf4\u662fwindow\u4e5f\u6ca1\u592a\u5927\u95ee\u9898\u3002\u6211\u60f3\u8865\u5145\u7684\u662f `nodejs` \u4e5f\u5b9e\u73b0\u4e86 ES\u6807\u51c6\u3002\u6240\u4ee5\u6211\u4eec\u5b9e\u73b0\u7684\u65f6\u5019\uff0c\u662f\u4e0d\u662f\u8981\u8003\u8651\u5230 `nodejs`\u73af\u5883\u5462\u3002\n3. \u539f\u59cb\u503c\u4f1a\u88ab\u5305\u88c5\u3002\u600e\u4e48\u4e2a\u5305\u88c5\u5462\uff0c`Object(val)`\uff0c\u5373\u5b8c\u6210\u4e86\u5bf9\u539f\u59cb\u503c`val`\u7684\u5305\u88c5\u3002\n\n\n### ES\u6807\u51c6\n\u5728 [Function.prototype.call() - JavaScript | MDN](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function/call)\u7684\u5e95\u90e8\u7f57\u5217\u4e86ES\u89c4\u8303\u7248\u672c\uff0c\u6bcf\u4e2a\u7248\u672c\u90fd\u6709`call\u5b9e\u73b0\u7684`\u8bf4\u660e\u3002\n\n\u6211\u4eec\u5b9e\u73b0\u7684\uff0c\u662f\u8981\u57fa\u4e8eES\u7684\u67d0\u4e2a\u7248\u672c\u6765\u5b9e\u73b0\u7684\u3002\n\n\u56e0\u4e3aES\u7684\u7248\u672c\u4e0d\u540c\uff0c\u5b9e\u73b0\u7684\u7ec6\u8282\u53ef\u80fd\u4e0d\u4e00\u6837\uff0c\u5b9e\u73b0\u7684\u73af\u5883\u4e5f\u4e0d\u4e00\u6837\u3002\n\n<table class=\"standard-table\">\n <tbody>\n  <tr>\n   <th scope=\"col\">\u89c4\u8303\u7248\u672c</th>\n   <th scope=\"col\">\u72b6\u6001</th>\n   <th scope=\"col\">\u8bf4\u660e</th>\n  </tr>\n  <tr>\n   <td><a href=\"https://www.ecma-international.org/publications/files/ECMA-ST-ARCH/ECMA-262,%201st%20edition,%20June%201997.pdf\" hreflang=\"en\" lang=\"en\" class=\"external\" title=\"ECMAScript 1st Edition (ECMA-262)\" rel=\" noopener\">ECMAScript 1st Edition (ECMA-262)</a></td>\n   <td><span class=\"spec-standard\">Standard</span></td>\n   <td>\u521d\u59cb\u5b9a\u4e49\u3002\u5728 JavaScript 1.3 \u4e2d\u5b9e\u73b0\u3002</td>\n  </tr>\n  <tr>\n   <td><a href=\"https://www.ecma-international.org/ecma-262/5.1/#sec-15.3.4.4\" hreflang=\"en\" lang=\"en\" class=\"external\" rel=\" noopener\">ECMAScript 5.1 (ECMA-262)<br><small lang=\"zh-CN\">Function.prototype.call</small></a></td>\n   <td><span class=\"spec-standard\">Standard</span></td>\n   <td></td>\n  </tr>\n  <tr>\n   <td><a href=\"https://www.ecma-international.org/ecma-262/6.0/#sec-function.prototype.call\" hreflang=\"en\" lang=\"en\" class=\"external\" rel=\" noopener\">ECMAScript 2015 (6th Edition, ECMA-262)<br><small lang=\"zh-CN\">Function.prototype.call</small></a></td>\n   <td><span class=\"spec-standard\">Standard</span></td>\n   <td></td>\n  </tr>\n  <tr>\n   <td><a href=\"https://tc39.es/ecma262/#sec-function.prototype.call\" hreflang=\"en\" lang=\"en\" class=\"external\" rel=\" noopener\">ECMAScript (ECMA-262)<br><small lang=\"zh-CN\">Function.prototype.call</small></a></td>\n   <td><span class=\"spec-living\">Living Standard</span></td>\n   <td></td>\n  </tr>\n </tbody>\n</table>\n\n\u5728ES3\u6807\u51c6\u4e2d\u5173\u4e8e`call`\u7684\u89c4\u8303\u8bf4\u660e\u5728`11.2.3 Function Calls`, \u76f4\u63a5\u641c\u7d22\u5c31\u80fd\u67e5\u5230\u3002\n\n\u6211\u4eec\u4eca\u5929\u4e3b\u8981\u662f\u57fa\u4e8e2009\u5e74ES5\u6807\u51c6\u4e0b\u6765\u5b9e\u73b0`Function.prototype.call`\uff0c\u6709\u4eba\u53ef\u80fd\u4f1a\u8bf4\uff0c\u4f60\u8fd9\uff0c\u4e3a\u561b\u4e0d\u5728 ES3\u6807\u51c6\u4e0b\u5b9e\u73b0\uff0c\u56e0\u4e3aES5\u4e0b\u80fd\u6d89\u53ca\u66f4\u591a\u7684\u77e5\u8bc6\u70b9\u3002\n\n## \u4e0d\u53ef\u9760\u7684undefined\n\n\n`(context == null || context == undefined) ? window : new  Object(context)`\n\n\u4e0a\u9762\u4ee3\u7801\u7684 `undefined` \u4e0d\u4e00\u5b9a\u662f\u53ef\u9760\u7684\u3002\n\n\u5f15\u7528\u4e00\u6bb5MDN\u7684\u8bdd\uff1a\n> \u5728\u73b0\u4ee3\u6d4f\u89c8\u5668\uff08JavaScript 1.8.5/Firefox 4+\uff09\uff0c\u81eaECMAscript5\u6807\u51c6\u4ee5\u6765undefined\u662f\u4e00\u4e2a\u4e0d\u80fd\u88ab\u914d\u7f6e\uff08non-configurable\uff09\uff0c\u4e0d\u80fd\u88ab\u91cd\u5199\uff08non-writable\uff09\u7684\u5c5e\u6027\u3002\u5373\u4fbf\u4e8b\u5b9e\u5e76\u975e\u5982\u6b64\uff0c\u4e5f\u8981\u907f\u514d\u53bb\u91cd\u5199\u5b83\u3002\n\n\u5728\u6ca1\u6709\u4ea4\u4ee3\u4e0a\u4e0b\u6587\u7684\u60c5\u51b5\u4f7f\u7528 `void 0` \u6bd4\u76f4\u63a5\u4f7f\u7528 `undefined` \u66f4\u4e3a\u5b89\u5168\u3002\n\n\u6709\u4e9b\u540c\u5b66\u53ef\u80fd\u6ca1\u89c1\u8fc7undefined\u88ab\u6539\u5199\u7684\u60c5\u51b5\uff0c\u6ca1\u4e8b\uff0c\u6765\u4e00\u5f20\u56fe\uff1a\n\n![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a3c24cb13a04465b9657bac9a8dbaf7f~tplv-k3u1fbpfcp-watermark.image)\n\n`void` \u8fd9\u4e2a\u4e00\u5143\u8fd0\u7b97\u6cd5\u9664\u4e86\u8fd9\u4e2a \u51c6\u5907\u8fd4\u56de `undefined`\u5916\uff0c \u8fd8\u6709\u53e6\u5916\u4e24\u4ef6\u5e38\u89c1\u7684\u7528\u9014\uff1a\n1. a\u6807\u7b7e\u7684href\uff0c\u5c31\u662f\u4ec0\u4e48\u90fd\u4e0d\u505a   \n    `<a href=\"javascript:void(0);\">`   \n    \n2. IIFE\u7acb\u5373\u6267\u884c\n```js\n;void function(msg){\n    console.log(msg)\n}(\"\u4f60\u597d\u554a\");\n\n```\n\u5f53\u7136\u66f4\u76f4\u63a5\u7684\u65b9\u5f0f\u662f:\n```js\n;(function(msg){\n    console.log(msg)\n})(\"\u4f60\u597d\u554a\");\n```\n\n## \u6d4f\u89c8\u5668\u548cnodejs\u73af\u5883\u8bc6\u522b\n\n\u6d4f\u89c8\u5668\u73af\u5883:\n```js\ntypeof self == 'object' && self.self === self\n```\n\nnodejs\u73af\u5883\uff1a\n```js\ntypeof global == 'object' && global.global === global\n```\n\n\u73b0\u5728\u5df2\u7ecf\u6709 [globalThis](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/globalThis), \u5728\u9ad8\u7248\u672c\u6d4f\u89c8\u5668\u548cnodejs\u91cc\u9762\u90fd\u652f\u6301\u3002 \n\n\u663e\u7136\uff0c\u5728\u6211\u4eec\u7684\u8fd9\u4e2a\u573a\u666f\u4e0b\uff0c\u8fd8\u4e0d\u80fd\u7528\uff0c\u4f46\u662f\u5176\u601d\u60f3\u53ef\u4ee5\u501f\u9274\uff1a\n```js\nvar getGlobal = function () {\n  if (typeof self !== 'undefined') { return self; }\n  if (typeof window !== 'undefined') { return window; }\n  if (typeof global !== 'undefined') { return global; }\n  throw new Error('unable to locate global object');\n};\n```\n\n## \u4e25\u683c\u6a21\u5f0f\n\n\n### \u662f\u5426\u652f\u6301\u4e25\u683c\u6a21\u5f0f\n[Strict mode](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Strict_mode) \u4e25\u683c\u6a21\u5f0f\uff0c\u662fES5\u5f15\u5165\u7684\u7279\u6027\u3002\u90a3\u6211\u4eec\u600e\u4e48\u9a8c\u8bc1\u4f60\u7684\u73af\u5883\u662f\u4e0d\u662f\u652f\u6301\u4e25\u683c\u6a21\u5f0f\u5462\uff1f   \n```js\nvar hasStrictMode = (function(){ \n \"use strict\";\n return this == undefined;\n}());\n```\n\u6b63\u5e38\u60c5\u51b5\u90fd\u4f1a\u8fd4\u56de`true`,\u653e\u5230IE8\u91cc\u9762\u6267\u884c\uff1a\n\n![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/483ba137a3e54dd8af535435df5fe325~tplv-k3u1fbpfcp-watermark.image)\n\n\u5728\u975e\u4e25\u683c\u6a21\u5f0f\u4e0b\uff0c\u51fd\u6570\u7684\u8c03\u7528\u4e0a\u4e0b\u6587\uff08this\u7684\u503c\uff09\u662f\u5168\u5c40\u5bf9\u8c61\u3002\u5728\u4e25\u683c\u6a21\u5f0f\u4e0b\uff0c\u8c03\u7528\u4e0a\u4e0b\u6587\u662fundefined\u3002\n\n### \u662f\u5426\u5904\u4e8e\u4e25\u683c\u6a21\u5f0f\u4e0b\n\u77e5\u9053\u662f\u4e0d\u662f\u652f\u6301\u4e25\u683c\u6a21\u5f0f\uff0c\u8fd8\u4e0d\u591f\uff0c\u6211\u4eec\u8fd8\u8981\u77e5\u9053\u6211\u4eec\u662f\u4e0d\u662f\u5904\u4e8e\u4e25\u683c\u6a21\u5f0f\u4e0b\u3002   \n\n\u5982\u4e0b\u7684\u4ee3\u7801\u53ef\u4ee5\u68c0\u6d4b\uff0c\u662f\u4e0d\u662f\u5904\u4e8e\u4e25\u683c\u6a21\u5f0f\uff1a \n```js\nvar isStrict = (function(){\n\u3000\u3000return this === undefined;\n}());\n```\n\u8fd9\u6bb5\u4ee3\u7801\u5728\u652f\u6301\u4e25\u683c\u6a21\u5f0f\u7684\u6d4f\u89c8\u5668\u4e0b\u548c`nodejs`\u73af\u5883\u4e0b\u90fd\u662f\u5de5\u4f5c\u7684\u3002\n\n\n## \u51fd\u6570\u526f\u4f5c\u7528\n```js\n  var r = eval('context.fn(' + arr + ')');\n  delete context.fn;\n```\n\n\u5982\u4e0a\u7684\u4ee3\u7801\u76f4\u63a5\u5220\u9664\u4e86context\u4e0a\u7684`fn`\u5c5e\u6027\uff0c\u5982\u679c\u539f\u6765\u7684context\u4e0a\u6709`fn`\u5c5e\u6027\uff0c\u90a3\u4f1a\u4e0d\u4f1a\u4e22\u5931\u5462\uff1f\n\n\u6211\u4eec\u91c7\u7528`eval`\u7248\u672c\u7684`call`, \u6267\u884c\u4e0b\u9762\u7684\u4ee3\u7801\n```js\nvar context = {\n  fn: \"i am fn\",\n  msg: \"i am msg\"\n}\n\nlog.call(context);  // i am msg\n\nconsole.log(\"msg:\", context.msg); // i am msg\nconsole.log(\"fn:\", context.fn); // fn: undedined\n```\n\u53ef\u4ee5\u770b\u5230context\u7684`fn`\u5c5e\u6027\u5df2\u7ecf\u88ab\u5e72\u6389\u4e86\uff0c\u662f\u7834\u574f\u4e86\u5165\u53c2\uff0c\u4ea7\u751f\u4e86\u4e0d\u8be5\u4ea7\u751f\u7684\u526f\u4f5c\u7528\u3002  \n\u4e0e\u526f\u4f5c\u7528\u5bf9\u5e94\u7684\u662f\u51fd\u6570\u5f0f\u7f16\u7a0b\u4e2d\u7684 **\u7eaf\u51fd\u6570**\u3002 \n\n\u5bf9\u5e94\u7684\u6211\u4eec\u8981\u91c7\u53d6\u884c\u52a8\uff0c\u57fa\u672c\u4e24\u79cd\u601d\u8def\uff1a\n1. \u9020\u4e00\u4e2a\u4e0d\u4f1a\u91cd\u540d\u7684\u5c5e\u6027\n2. \u4fdd\u7559\u73b0\u573a\u7136\u540e\u8fd8\u539f\u73b0\u573a\n\n\u90fd\u53ef\u4ee5\uff0c\u4e0d\u8fc7\u89c9\u5f97 \u65b9\u68482\u66f4\u7b80\u5355\u548c\u5bb9\u6613\u5b9e\u73b0\uff1a  \n\u57fa\u672c\u4ee3\u7801\u5982\u4e0b\uff1a\n```js\nvar ctx = new Object(context);\n\nvar propertyName = \"__fn__\";\nvar originVal;\nvar hasOriginVal = ctx.hasOwnProperty(propertyName)\nif(hasOriginVal){\n    originVal = ctx[propertyName]\n}\n\n...... // \u5176\u4ed6\u4ee3\u7801\n\nif(hasOriginVal){\n    ctx[propertyName] = originVal;\n}\n  \n```\n\n\n## \u57fa\u4e8e`eval`\u7684\u5b9e\u73b0\uff0c\u57fa\u672c\u5982\u4e0b\n\n\u57fa\u4e8e\u6807\u51c6[ECMAScript 5.1 (ECMA-262)\nFunction.prototype.call](https://262.ecma-international.org/5.1/#sec-15.3.4.4)\n\n```js\nWhen the call method is called on an object func with argument thisArg and optional arguments arg1, arg2 etc, the following steps are taken:\n\n1. If IsCallable(func) is false, then throw a TypeError exception.\n\n2. Let argList be an empty List.\n\n3. If this method was called with more than one argument then in left to right \norder starting with arg1 append each argument as the last element of argList\n\n4. Return the result of calling the [[Call]] internal method of func, providing \nthisArg as the this value and argList as the list of arguments.\nThe length property of the call method is 1.\n\nNOTE The thisArg value is passed without modification as the this value. This is a \nchange from Edition 3, where a undefined or null thisArg is replaced with the  \nglobal object and ToObject is applied to all other values and that result is passed \nas the this value.\n```\n\n\u5bf9\u6211\u4eec\u6bd4\u8f83\u91cd\u8981\u7684\u662f `1`\u548c `Note`:\n\n\u770b\u770b\u6211\u4eec\u7684\u57fa\u7840\u5b9e\u73b0\n\n```js\nvar hasStrictMode = (function () {\n    \"use strict\";\n    return this == undefined;\n}());\n\nvar isStrictMode = function () {\n    return this === undefined;\n};\n\nvar getGlobal = function () {\n    if (typeof self !== 'undefined') { return self; }\n    if (typeof window !== 'undefined') { return window; }\n    if (typeof global !== 'undefined') { return global; }\n    throw new Error('unable to locate global object');\n};\n\nfunction isFunction(fn){\n    return typeof fn === \"function\";\n}\n\nfunction getContext(context) {\n\n    var isStrict = isStrictMode();\n\n    if (!hasStrictMode || (hasStrictMode && !isStrict)) {\n        return (context === null || context === void 0) ? getGlobal() : Object(context);\n    }\n\n    // \u4e25\u683c\u6a21\u5f0f\u4e0b, \u59a5\u534f\u65b9\u6848\n    return Object(context);\n}\n\nFunction.prototype.call = function (context) {\n\n    // \u4e0d\u53ef\u4ee5\u88ab\u8c03\u7528\n    if (typeof this !== 'function') {\n        throw new TypeError(this + ' is not a function');\n    }\n    \n    // \u83b7\u53d6\u4e0a\u4e0b\u6587\n    var ctx = getContext(context);\n\n    // \u66f4\u4e3a\u7a33\u59a5\u7684\u662f\u521b\u5efa\u552f\u4e00ID, \u4ee5\u53ca\u68c0\u67e5\u662f\u5426\u6709\u91cd\u540d\n    var propertyName = \"__fn__\" + Math.random() + \"_\" + new Date().getTime();\n    var originVal;\n    var hasOriginVal = isFunction(ctx.hasOwnProperty) ? ctx.hasOwnProperty(propertyName) : false;\n    if (hasOriginVal) {\n        originVal = ctx[propertyName]\n    }\n    \n    ctx[propertyName] = this;    \n\n    // \u91c7\u7528string\u62fc\u63a5\n    var argStr = '';\n    var len = arguments.length;\n    for (var i = 1; i < len; i++) {\n        argStr += (i === len - 1) ? 'arguments[' + i + ']' : 'arguments[' + i + '],'\n    }\n    var r = eval('ctx[\"' + propertyName + '\"](' + argStr + ')');\n\n    // \u8fd8\u539f\u73b0\u573a\n    if (hasOriginVal) {\n        ctx[propertyName] = originVal;\n    } else {\n        delete ctx[propertyName]\n    }\n\n    return r;\n}\n\n```\n\n\u5f53\u524d\u7248\u4f9d\u65e7\u5b58\u5728\u95ee\u9898\uff0c   \n1. \u4e25\u683c\u6a21\u5f0f\u4e0b\uff0c\u6211\u4eec\u7528\u4f9d\u7136\u7528`Obeject`\u8fdb\u884c\u4e86\u5c01\u88c5\u3002\n**\u4f1a\u5bfc\u81f4\u4e25\u683c\u6a21\u5f0f\u4e0b\u4f20\u9012\u975e\u5bf9\u8c61\u7684\u65f6\u5019\uff0cthis\u7684\u6307\u5411\u662f\u4e0d\u51c6\u7684\uff0c \u4e0d\u5f97\u4ee5\u7684\u59a5\u534f\u3002** \n \u54ea\u4f4d\u540c\u5b66\u6709\u66f4\u597d\u7684\u65b9\u6848\uff0c\u656c\u8bf7\u6307\u5bfc\u3002\n\n2. \u867d\u8bf4\u6211\u4eec\u628a\u4e34\u65f6\u7684\u5c5e\u6027\u540d\u53d8\u5f97\u96be\u4ee5\u91cd\u540d\uff0c\u4f46\u662f\u5982\u679c\u91cd\u540d\uff0c\u800c\u51fd\u6570\u8c03\u7528\u4e2d\u771f\u8c03\u7528\u4e86\u6b64\u65b9\u6cd5\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u5f02\u5e38\u884c\u4e3a\u3002   \n\n \u6240\u4ee5\u5b8c\u7f8e\u7684\u89e3\u51b3\u65b9\u6cd5\uff0c\u5c31\u662f\u4ea7\u751f\u4e00\u4e2aUID.\n \n3. `eval`\u7684\u6267\u884c\uff0c\u53ef\u80fd\u4f1a\u88ab [Content-Security-Policy](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CSP) \u963b\u6b62\n\n\u5927\u81f4\u7684\u63d0\u793a\u4fe1\u606f\u5982\u4e0b\uff1a\n```js\n[Report Only] Refused to evaluate a string as JavaScript because 'unsafe-eval' is not an   \nallowed source of script in the following Content Security Policy directive: \"script-src \n.........\n```\n\n![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/67083b47e4264be1a33f12a23c106d26~tplv-k3u1fbpfcp-watermark.image)\n\n\n\u524d\u9762\u4e24\u6761\u90fd\u5e94\u8be5\u8fd8\u80fd\u63a5\u53d7\uff0c\u81f3\u4e8e\u7b2c\u4e09\u6761\uff0c\u6211\u4eec\u4e0d\u80fd\u59a5\u534f\u3002\n\n\u8fd9\u5c31\u5f97\u8bf7\u51fa\u4e0b\u4e00\u4f4d\u5609\u5bbe, `new Function`\u3002\n\n## [new Function](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function)\n\n> new Function ([arg1[, arg2[, ...argN]],] functionBody)\n\n\u5176\u57fa\u672c\u683c\u5f0f\u5982\u4e0a\uff0c\u6700\u540e\u4e00\u4e2a\u4e3a\u51fd\u6570\u4f53\u3002\n\n\u4e3e\u4e2a\u7b80\u5355\u7684\u4f8b\u5b50\uff1a\n```js\nconst sum = new Function('a', 'b', 'return a + b');\n\nconsole.log(sum(2, 6));\n// expected output: 8\n```\n\n\u6211\u4eec`call`\u7684\u53c2\u6570\u4e2a\u6570\u662f\u4e0d\u56fa\u5b9a\uff0c\u601d\u8def\u5c31\u662f\u4ece`arguments`\u52a8\u6001\u83b7\u53d6\u3002\n\n\u8fd9\u91cc\u6211\u4eec\u7684\u5b9e\u73b0\u501f\u7528[\u9762\u8bd5\u5b98\u95ee\uff1a\u80fd\u5426\u6a21\u62df\u5b9e\u73b0JS\u7684call\u548capply\u65b9\u6cd5](https://juejin.cn/post/6844903728147857415) \u5b9e\u73b0\u65b9\u6cd5\uff1a\n```js\nfunction generateFunctionCode(argsArrayLength){\n    var code = 'return arguments[0][arguments[1]](';\n    for(var i = 0; i < argsArrayLength; i++){\n        if(i > 0){\n            code += ',';\n        }\n        code += 'arguments[2][' + i + ']';\n    }\n    code += ')';\n    // return arguments[0][arguments[1]](arg1, arg2, arg3...)\n    return code;\n}\n\n```\n## \u57fa\u4e8e new Function\u7684\u5b9e\u73b0\n\n```js\nvar hasStrictMode = (function () {\n    \"use strict\";\n    return this == undefined;\n}());\n\nvar isStrictMode = function () {\n    return this === undefined;\n};\n\nvar getGlobal = function () {\n    if (typeof self !== 'undefined') { return self; }\n    if (typeof window !== 'undefined') { return window; }\n    if (typeof global !== 'undefined') { return global; }\n    throw new Error('unable to locate global object');\n};\n\nfunction isFunction(fn){\n    return typeof fn === \"function\";\n}\n\nfunction getContext(context) {\n    var isStrict = isStrictMode();\n\n    if (!hasStrictMode || (hasStrictMode && !isStrict)) {\n        return (context === null || context === void 0) ? getGlobal() : Object(context);\n    }\n    // \u4e25\u683c\u6a21\u5f0f\u4e0b, \u59a5\u534f\u65b9\u6848\n    return Object(context);\n}\n\n\nfunction generateFunctionCode(argsLength){\n    var code = 'return arguments[0][arguments[1]](';\n    for(var i = 0; i < argsLength; i++){\n        if(i > 0){\n            code += ',';\n        }\n        code += 'arguments[2][' + i + ']';\n    }\n    code += ')';\n    // return arguments[0][arguments[1]](arg1, arg2, arg3...)\n    return code;\n}\n\n\nFunction.prototype.call = function (context) {\n\n    // \u4e0d\u53ef\u4ee5\u88ab\u8c03\u7528\n    if (typeof this !== 'function') {\n        throw new TypeError(this + ' is not a function');\n    }\n\n    // \u83b7\u53d6\u4e0a\u4e0b\u6587\n    var ctx = getContext(context);\n\n    // \u66f4\u4e3a\u7a33\u59a5\u7684\u662f\u521b\u5efa\u552f\u4e00ID, \u4ee5\u53ca\u68c0\u67e5\u662f\u5426\u6709\u91cd\u540d\n    var propertyName = \"__fn__\" + Math.random() + \"_\" + new Date().getTime();\n    var originVal;\n    var hasOriginVal = isFunction(ctx.hasOwnProperty) ? ctx.hasOwnProperty(propertyName) : false;\n    if (hasOriginVal) {\n        originVal = ctx[propertyName]\n    }\n\n    ctx[propertyName] = this;\n \n    var argArr = [];\n    var len = arguments.length;\n    for (var i = 1; i < len; i++) {\n        argArr[i - 1] = arguments[i];\n    }\n\n    var r = new Function(generateFunctionCode(argArr.length))(ctx, propertyName, argArr);\n\n    // \u8fd8\u539f\u73b0\u573a\n    if (hasOriginVal) {\n        ctx[propertyName] = originVal;\n    } else {\n        delete ctx[propertyName]\n    }\n\n    return r;\n}\n\n```\n## \u8bc4\u8bba\u533a\u95ee\u9898\u6536\u96c6\n\u8bc4\u8bba\u533a\u6700\u7cbe\u5f69\uff1a  \n1. \u4e3a\u4ec0\u4e48\u4e0d\u7528 `Symbol`\n\u56e0\u4e3a\u662f\u57fa\u4e8eES5\u7684\u6807\u51c6\u6765\u5199\uff0c\u5982\u679c\u4f7f\u7528`Symbol`\uff0c\u90a3\u62d3\u5c55\u8fd0\u7b97\u7b26\u4e5f\u53ef\u4ee5\u4f7f\u7528\u3002 \u8003\u5bdf\u7684\u77e5\u8bc6\u9762\u81ea\u7136\u5c11\u5f88\u591a\u3002\n\n2. \u652f\u4ed8\u5b9d\u5c0f\u7a0b\u5e8fevel\u3001new Function\u90fd\u662f\u4e0d\u7ed9\u7528\u7684\n\u8fd9\u6837\u5b50\u7684\u8bdd\uff0c\u53ef\u80fd\u771f\u7684\u65e0\u80fd\u4e3a\u529b\u4e86\u3002 \n\n3. Object.freeze\u540e\u7684\u5bf9\u8c61\u662f\u4e0d\u53ef\u4ee5\u6dfb\u52a0\u5c5e\u6027\u7684\n\u611f\u8c22[\u865a\u9cb2\u83dc\u83dc\u5b50](https://juejin.cn/user/1292681404747374)\u7684\u6307\u6b63\uff0c\u5176\u6587\u7ae0[\u624b\u5199 call \u4e0e \u539f\u751f Function.prototype.call \u7684\u533a\u522b](https://juejin.cn/post/6935736906558734350) \u63a8\u8350\u5927\u5bb6\u7ec6\u8bfb\u3002\n\n\u5982\u4e0b\u7684\u4ee3\u7801\uff0c\u4e25\u683c\u6a21\u5f0f\u4e0b\u4f1a\u62a5\u9519\uff0c\u975e\u4e25\u683c\u6a21\u5f0f\u590d\u5236\u4e0d\u6210\u529f\uff1a\n```js\n\"use strict\";\nvar context = {\n    a: 1,\n    log(msg){\n        console.log(\"msg:\", msg)\n    }\n};\n\nObject.freeze(context);\ncontext.fn = function(){\n\n};\n\nconsole.log(context.fn);\n\nVM111 call:12 Uncaught TypeError: Cannot add property fn, object is not extensible\n    at VM49 call:12\n```\n\n\u8fd9\u79cd\u60c5\u51b5\u600e\u4e48\u529e\u5462\uff0c\u6211\u80fd\u60f3\u5230\u7684\u662f\u4e24\u79cd\u65b9\u5f0f\uff1a\n1. \u590d\u5236\u5bf9\u8c61\n2. `Obect.create`\n\u8fd9\u4e5f\u7b97\u662f\u4e00\u79cd\u59a5\u534f\u65b9\u6cd5\uff0c\u6bd5\u7adf\u94fe\u8def\u8fd8\u662f\u53d8\u957f\u4e86\u3002\n```js\n\"use strict\";\nvar context = {\n    a: 1,\n    log(msg){\n        console.log(\"msg:\", msg)\n    }\n};\n\nObject.freeze(context);\n\nvar ctx =  Object.create(context);\n\nctx.fn = function(){\n\n}\n\nconsole.log(\"fn:\", typeof ctx.fn);  // fn: function\nconsole.log(\"ctx.a\", ctx.a);  // ctx.a 1\nconsole.log(\"ctx.fn\", ctx.fn); // ctx.fn \u0192 (){}\n```\n\n## \u5c0f\u7ed3\n\u56de\u987e\u4e00\u4e0b\u4f9d\u65e7\u5b58\u5728\u7684\u95ee\u9898\n1. \u4e25\u683c\u6a21\u5f0f\u4e0b\uff0c\u6211\u4eec\u7528\u4f9d\u7136\u9700\u8981\u7528`Object`\u8fdb\u884c\u4e86\u5c01\u88c5\u57fa\u7840\u6570\u636e\u7c7b\u578b\n**\u4f1a\u5bfc\u81f4\u4e25\u683c\u6a21\u5f0f\u4e0b\u4f20\u9012\u975e\u5bf9\u8c61\u7684\u65f6\u5019\uff0cthis\u7684\u6307\u5411\u662f\u4e0d\u51c6\u7684\uff0c \u4e0d\u5f97\u4ee5\u7684\u59a5\u534f\u3002** \n \u54ea\u4f4d\u540c\u5b66\u6709\u66f4\u597d\u7684\u65b9\u6848\uff0c\u656c\u8bf7\u6307\u5bfc\u3002\n\n2. \u867d\u8bf4\u6211\u4eec\u628a\u4e34\u65f6\u7684\u5c5e\u6027\u540d\u53d8\u5f97\u96be\u4ee5\u91cd\u540d\uff0c\u4f46\u662f\u5982\u679c\u91cd\u540d\uff0c**\u800c\u51fd\u6570\u8c03\u7528\u4e2d\u771f\u8c03\u7528\u4e86\u6b64\u65b9\u6cd5\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u5f02\u5e38\u884c\u4e3a**\n\n3. \u5c0f\u7a0b\u5e8f\u7b49\u73af\u5883\u53ef\u80fd\u7981\u6b62\u4f7f\u7528`eval`\u548c`new Function`\n\n4. \u5bf9\u8c61\u88ab\u51bb\u7ed3\uff0c`call`\u6267\u884c\u51fd\u6570\u4e2d\u7684`this`\u4e0d\u662f**\u771f\u6b63**\u4f20\u5165\u7684\u4e0a\u4e0b\u6587\u5bf9\u8c61\u3002\n\n\u6240\u4ee5\uff0c\u6211\u8fd8\u662f\u4fee\u6539\u6807\u9898\u4e3a**\u4e09\u5343\u6587\u5b57\uff0c\u4e5f\u6ca1\u5199\u597d Function.prototype.call**\n\n## \u9762\u8bd5\u73b0\u573a\n\n\u4e00\u4e2a\u624b\u5199`call`\u6d89\u53ca\u5230\u4e0d\u5c11\u7684\u77e5\u8bc6\u70b9\uff0c\u672c\u4eba\u6c34\u5e73\u6709\u9650\uff0c\u5982\u6709\u9057\u6f0f\uff0c\u656c\u8bf7\u8c05\u89e3\u548c\u8865\u5145\u3002  \n\n\u5f53\u9762\u8bd5\u5b98\u95ee\u9898\u7684\u65f6\u5019\uff0c\u4f60\u8981\u6e05\u695a\u81ea\u5df1\u9762\u8bd5\u7684\u5c97\u4f4d\uff0c\u662fP6,P7\u8fd8\u662fP8\u3002   \n\u662f\u9ad8\u7ea7\u5f00\u53d1\u8fd8\u662f\u524d\u7aef\u7ec4\u957f\uff0c\u6291\u6216\u662f\u524d\u7aef\u8d1f\u8d23\u4eba\u3002   \n\u5c97\u4f4d\u4e0d\u4e00\u6837\uff0c\u9762\u8bd5\u5b98\u5f53\u7136\u671f\u671b\u7684\u7b54\u6848\u4e5f\u4e0d\u4e00\u6837\u3002\n\n## \u5199\u5728\u6700\u540e\n\u5199\u4f5c\u4e0d\u6613\uff0c\u60a8\u7684\u652f\u6301\u5c31\u662f\u6211\u524d\u884c\u7684\u6700\u5927\u52a8\u529b\u3002  \n\n\n\n## \u53c2\u8003\u548c\u5f15\u7528\n> [Function.prototype.call() - JavaScript | MDN](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function/call)   \n> [Strict mode - JavaScript | MDN](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Strict_mode)    \n> [ECMAScript 5 Strict Mode](https://caniuse.com/use-strict)  \n> [ES\u5408\u96c6](https://yanhaijing.com/es5)   \n> [\u624b\u5199call\u3001apply\u3001bind\u5b9e\u73b0\u53ca\u8be6\u89e3](https://juejin.cn/post/6844903773979033614)   \n> [call\u3001apply\u3001bind\u5b9e\u73b0\u539f\u7406](https://juejin.cn/post/6977563249650696206)   \n> [\u9762\u8bd5\u5b98\u95ee\uff1a\u80fd\u5426\u6a21\u62df\u5b9e\u73b0JS\u7684call\u548capply\u65b9\u6cd5](https://juejin.cn/post/6844903728147857415)\n"}, "author_user_info": {"user_id": "131597122679661", "user_name": "\u4e91\u7684\u4e16\u754c", "company": "\u4e91\u7684\u4e16\u754c", "job_title": "\u524d\u7aef\u5de5\u7a0b\u5e08", "avatar_large": "https://sf1-ttcdn-tos.pstatp.com/img/user-avatar/f1a9f122e925aeef5e4534ff7f706729~300x300.image", "level": 3, "description": "\u770b\u4e16\u754c\uff0c\u542c\u4e16\u754c\uff0c\u95ee\u4e16\u754c\u3002", "followee_count": 45, "follower_count": 448, "post_article_count": 28, "digg_article_count": 1155, "got_digg_count": 3527, "got_view_count": 122470, "post_shortmsg_count": 6, "digg_shortmsg_count": 1, "isfollowed": false, "favorable_author": 0, "power": 4751, "study_point": 0, "university": {"university_id": "0", "name": "", "logo": ""}, "major": {"major_id": "0", "parent_id": "0", "name": ""}, "student_status": 0, "select_event_count": 0, "select_online_course_count": 0, "identity": 0, "is_select_annual": false, "select_annual_rank": 0, "annual_list_type": 0, "extraMap": {}, "is_logout": 0}, "category": {"category_id": "6809637767543259144", "category_name": "\u524d\u7aef", "category_url": "frontend", "rank": 2, "ctime": 1457483942, "mtime": 1432503190, "show_type": 3, "item_type": 2}, "tags": [{"id": 2546526, "tag_id": "6809640407484334093", "tag_name": "\u524d\u7aef", "color": "#60ADFF", "icon": "https://lc-gold-cdn.xitu.io/bac28828a49181c34110.png", "back_ground": "", "show_navi": 1, "ctime": 1435971546, "mtime": 1627872151, "id_type": 9, "tag_alias": "", "post_article_count": 74593, "concern_user_count": 526758}], "user_interact": {"id": 6978744007601946654, "omitempty": 2, "user_id": 0, "is_digg": false, "is_follow": false, "is_collect": false}, "org": {"org_info": null, "org_user": null, "is_followed": false}, "req_id": "server req_id test"}